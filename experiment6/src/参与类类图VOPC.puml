@startuml
' 1. View（视图类）
class V1 as "用户预约视图" <<View>>
class V2 as "代预约信息填写视图" <<View>>
class V3 as "支付宝支付视图" <<View>>
class V4 as "老年患者免费校验视图" <<View>>
class V5 as "预约单/挂号单打印视图" <<View>>

' 2. Object（对象类）
class O1 as "用户对象" <<Object>>
class O2 as "患者对象" <<Object>>
class O3 as "预约记录对象" <<Object>>
class O4 as "出诊计划对象" <<Object>>
class O5 as "支付记录对象" <<Object>>
class O6 as "挂号单对象" <<Object>>

' 3. Processor（处理器类）
class P1 as "预约资格校验处理器" <<Processor>>
class P2 as "医生出诊查询处理器" <<Processor>>
class P3 as "预约信息提交处理器" <<Processor>>
class P4 as "挂号费金额计算处理器" <<Processor>>
class P5 as "支付宝支付对接处理器" <<Processor>>
class P6 as "缴费状态同步处理器" <<Processor>>

' 4. Connector（连接器类）
class C1 as "短信服务连接器" <<Connector>>
class C2 as "支付宝支付连接器" <<Connector>>
class C3 as "号源更新连接器" <<Connector>>
class C4 as "支付状态连接器" <<Connector>>

skinparam default {
  FontName 微软雅黑
  FontSize 8
  LineWidth 1
}

skinparam class<<View>> {
  BackgroundColor #99ccff
  FontColor #003366
}
skinparam class<<Object>> {
  BackgroundColor #99ff99
  FontColor #003300
}
skinparam class<<Processor>> {
  BackgroundColor #ffcc99
  FontColor #663300
}
skinparam class<<Connector>> {
  BackgroundColor #ff99cc
  FontColor #660033
}

' 第三步：定义关联关系
V1 -- P1 : 提交预约请求
V1 -- P2 : 请求查询可预约医生
V2 -- P1 : 提交代预约患者信息
V3 -- P5 : 提交支付宝支付请求
V4 -- P4 : 提交患者年龄信息
V5 -- P3 : 请求获取预约单数据
V5 -- P6 : 请求获取挂号单数据

P3 -- C1 : 触发预约成功短信
P3 -- C3 : 扣减医生号源
P5 -- C2 : 调用支付宝支付接口
P6 -- C4 : 同步支付状态
P6 -- C1 : 触发缴费成功短信

C3 -- O4 : 更新剩余号源
C4 -- O5 : 创建/更新支付记录
C4 -- O3 : 更新预约缴费状态
C4 -- O6 : 生成挂号单

P1 -- O1 : 查询信用等级/预约数量
P1 -- O2 : 验证患者信息
P2 -- O4 : 筛选可预约医生
P3 -- O3 : 创建预约记录
P4 -- O2 : 查询患者年龄
P4 -- O3 : 查询基础挂号费

O3 -- O2 : 关联患者
O3 -- O4 : 关联出诊计划
O5 -- O3 : 关联预约记录
O6 -- O5 : 关联支付记录
@enduml