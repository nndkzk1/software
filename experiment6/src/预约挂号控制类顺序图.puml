@startuml
' 预约挂号用例 - 纯控制类顺序图
' 仅定义核心控制类作为参与者
participant "预约资格校验控制类" as C1
participant "代预约逻辑控制类" as C2
participant "医生出诊查询控制类" as C3
participant "预约信息提交控制类" as C4
participant "预约提醒触发控制类" as C5

skinparam default {
  FontName 微软雅黑
  FontSize 9
  LineWidth 1
}
skinparam participant {
  BackgroundColor #f0f8ff
  BorderColor #2f4f4f
}

' 纯控制类消息传递流程（按时间顺序，核心业务逻辑完整）
activate C1
' 1. 代预约场景：先处理代挂号关联
C1 -> C2: 接收预约请求，检测是否为代挂号
activate C2
C2 -> C2: 绑定登录用户与被代挂患者信息
C2 --> C1: 返回代预约绑定结果（成功/失败）
deactivate C2

' 2. 资格校验
C1 -> C1: 校验用户信用等级（≥0）+ 时间段内预约数量（≤5）
alt 资格校验失败
  C1 --> C1: 记录校验失败信息，终止流程
else 资格校验成功
  ' 3. 查询可预约医生
  C1 -> C3: 传递医院/科室/时间等查询条件
  activate C3
  C3 -> C3: 过滤满员医生，筛选可预约医生列表
  C3 --> C1: 返回可预约医生列表
  deactivate C3

  ' 4. 提交预约信息
  C1 -> C4: 传递选中医生信息 + 预约基础数据
  activate C4
  C4 -> C4: 扣减目标医生剩余号源
  C4 -> C4: 创建预约记录（关联用户/患者/医生信息）
  C4 --> C1: 返回预约提交结果（成功/失败）

  ' 5. 触发短信提醒
  C4 -> C5: 预约成功，传递用户手机号 + 预约信息
  activate C5
  C5 -> C5: 封装短信内容，触发短信发送接口
  C5 --> C4: 返回短信提醒触发结果
  deactivate C5
  deactivate C4
end
deactivate C1
@enduml